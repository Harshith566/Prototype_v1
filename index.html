<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VSBM 8K MELTDOWN</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="c1"></canvas>

<script>
var canvas = document.getElementById("c1");

// Internal resolution (GPU safe)
const W = 1920;
const H = 1080;

canvas.width = W;
canvas.height = H;
canvas.style.width  = "100vw";
canvas.style.height = "100vh";

var gl = canvas.getContext("webgl");

// framebuffer for accumulation
function makeTex(){
  let t=gl.createTexture();
  gl.bindTexture(gl.TEXTURE_2D,t);
  gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,W,H,0,gl.RGBA,gl.UNSIGNED_BYTE,null);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);
  return t;
}

let texA = makeTex();
let texB = makeTex();
let fb = gl.createFramebuffer();

var quad = [
-1,-1, 1,-1, 1,1,
-1,-1, 1,1, -1,1
];

var VSHADER = `
attribute vec2 p;
varying vec2 uv;
void main(){
  uv=p;
  gl_Position=vec4(p,0,1);
}`;

var FSHADER = `
#define RAY_STEPS 4000
#define KERNEL_ITERS 96

precision highp float;
varying vec2 uv;
uniform float time;
uniform sampler2D prev;

float kernal(vec3 p){
vec3 a=p;
float b,c,d;
for(int i=0;i<KERNEL_ITERS;i++){
b=length(a);
c=atan(a.y,a.x)*30.0;
d=acos(a.z/b)*30.0;
b=pow(b,18.0);
a=vec3(b*sin(d)*cos(c),b*sin(d)*sin(c),b*cos(d))+p;
a+=vec3(
sin(a.x*25.0+time),
cos(a.y*25.0-time),
sin(a.z*25.0+time*0.5)
)*0.25;
}
float r=dot(a,a);
for(int j=0;j<12;j++){
r+=sin(r*40.0)*0.2;
r=abs(r);
}
return 10.0-r;
}

void main(){
vec2 u=uv;
vec3 origin=vec3(0,0,5);
vec3 dir=normalize(vec3(u,-1.5));

float ang=time*0.3;
mat2 rot=mat2(cos(ang),-sin(ang),sin(ang),cos(ang));
dir.xz=rot*dir.xz;
origin.xz=rot*origin.xz;

vec3 color=texture2D(prev,u*0.5+0.5).rgb*0.96;
float t=0.0;

for(int k=0;k<RAY_STEPS;k++){
vec3 p=origin+dir*t;

float v=(
kernal(p)+
kernal(p+vec3(0.001))+
kernal(p-vec3(0.001))
)/3.0;

color+=vec3(
sin(v*7.0),
cos(v*9.0),
sin(v*13.0)
)*0.0009;

t+=0.001;
}

gl_FragColor=vec4(color,1.0);
}`;

function compile(type,src){
let s=gl.createShader(type);
gl.shaderSource(s,src);
gl.compileShader(s);
return s;
}

let prog=gl.createProgram();
gl.attachShader(prog,compile(gl.VERTEX_SHADER,VSHADER));
gl.attachShader(prog,compile(gl.FRAGMENT_SHADER,FSHADER));
gl.linkProgram(prog);
gl.useProgram(prog);

let buf=gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER,buf);
gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(quad),gl.STATIC_DRAW);

let loc=gl.getAttribLocation(prog,"p");
gl.vertexAttribPointer(loc,2,gl.FLOAT,false,0,0);
gl.enableVertexAttribArray(loc);

let timeLoc=gl.getUniformLocation(prog,"time");
let prevLoc=gl.getUniformLocation(prog,"prev");

let flip=0;

function render(t){

gl.bindFramebuffer(gl.FRAMEBUFFER,fb);
gl.framebufferTexture2D(
gl.FRAMEBUFFER,
gl.COLOR_ATTACHMENT0,
gl.TEXTURE_2D,
flip?texA:texB,
0);

gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D,flip?texB:texA);
gl.uniform1i(prevLoc,0);
gl.uniform1f(timeLoc,t*0.001);

gl.drawArrays(gl.TRIANGLES,0,6);

// draw to screen
gl.bindFramebuffer(gl.FRAMEBUFFER,null);
gl.bindTexture(gl.TEXTURE_2D,flip?texA:texB);
gl.drawArrays(gl.TRIANGLES,0,6);

flip^=1;

requestAnimationFrame(render);
}

render(0);
</script>
</body>
</html>
